stages:
  - test
  - build

test:
  stage: test
  image: node:12
  script:
    - npm install
    - npm run test

docker image:
  stage: build
  image: docker:19.03.0
  services:
    - docker:19.03.0-dind
  script:
    - docker build -t lotta/schedule-provider:$CI_COMMIT_SHA .
    - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_USER" --password-stdin
    - if [ $CI_COMMIT_REF_NAME == "master" ]; then docker tag lotta/schedule-provider:$CI_COMMIT_SHA lotta/schedule-provider:latest; fi;
    - docker push lotta/schedule-provider
